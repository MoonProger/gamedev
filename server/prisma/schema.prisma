generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum RoomStatus {
  WAITING
  IN_GAME
  FINISHED
}

model User {
  id           String       @id @default(cuid())
  email        String       @unique
  username     String
  passwordHash String
  createdAt    DateTime     @default(now())

  roomsCreated Room[]       @relation("RoomCreator")
  roomPlayers  RoomPlayer[]
}

model Room {
  id        String      @id @default(cuid())
  title     String
  status    RoomStatus  @default(WAITING)
  settings  Json
  createdAt DateTime    @default(now())

  creatorId String
  creator   User        @relation("RoomCreator", fields: [creatorId], references: [id])

  players   RoomPlayer[]
}

model RoomPlayer {
  roomId   String
  userId   String
  joinedAt DateTime  @default(now())
  isReady  Boolean   @default(false)

  room Room @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([roomId, userId])
}